<!DOCTYPE html>
<html>
<style>
  :root {
  color-scheme: light dark;
}
body {
  color: light-dark(#121212, #ffffffd0);
  background-color: light-dark(#ffffffd0, #121212);
}
.atomic-number {
  position: absolute;
  top: 10px;
  left: 10px;
  font-size: 18px;
  font-weight: bold;
}

.element-symbol {
  font-size: 60px;
  position: relative;
  top: -20px;
  font-weight: bold;
  text-align: center;
}

.element-name {
  position: absolute;
  bottom: 40px;
  width: 100%;
  text-align: center;
  font-size: 24px;
}

.atomic-weight {
  position: absolute;
  bottom: 10px;
  width: 100%;
  text-align: center;
  font-size: 16px;
}

.periodic-element {
  position: absolute;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  font-family: Arial, sans-serif;
  border-radius: 5px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
  width: 150px;
  height: 150px;
  outline: 5px solid rgb(17, 31, 160);
}
.fused{
  background-color: #2222ff;
}
.hold{
  z-index: 10;
}
</style>
<body>

<script>
let idNumber = 0;
function createPeriodicElement(atomicNumber, symbol, name, weight, x, y) {
    const elementDiv = document.createElement('div');
    elementDiv.className = 'periodic-element';
    elementDiv.style.left = `${x}px`;
    elementDiv.style.top = `${y}px`;
    elementDiv.id = `element${idNumber}`;

    elementDiv.innerHTML = `
        <div class="atomic-number">${atomicNumber}</div>
        <div class="element-symbol">${symbol}</div>
        <div class="element-name">${name}</div>
        <div class="atomic-weight">${weight}</div>
    `;
    idNumber++
    document.body.appendChild(elementDiv);
    dragElement(elementDiv);   
    return elementDiv;
}



function placeElement(x,y) {    
  createPeriodicElement(1,"H","Hydrogen",1.008,x,y)    
}

onload = function() {
  // TODO: Buscar otra manera de colocar los elementos iniciales
  let maxX = innerWidth - 40;
  let maxY = innerHeight - 60;
  const sizeX = maxX/5
  const sizeY = maxY/5
  for(let x = 10; x < maxX; x += sizeX){
    for(let y = 10; y < maxY; y += sizeY){
      placeElement(x,y)
    }
  }
}

/** Contiene toda la funcionalidad de movimiento */
function dragElement(elmnt) {
  var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
  elmnt.addEventListener("dblclick", (event) => {console.log("hacer que se cree una copia del elemento")});
  elmnt.onmousedown = dragMouseDown;
  function dragMouseDown(e) {
    e = e || window.event;
    e.preventDefault();
    // get the mouse cursor position at startup:
    pos3 = e.clientX;
    pos4 = e.clientY;
    elmnt.classList.add("hold")
    document.onmouseup = closeDragElement;
    // call a function whenever the cursor moves:
    document.onmousemove = elementDrag;
  }

  function elementDrag(e) {
    e = e || window.event;
    e.preventDefault();
    // calculate the new cursor position:
    pos1 = pos3 - e.clientX;
    pos2 = pos4 - e.clientY;
    pos3 = e.clientX;
    pos4 = e.clientY;
    // set the element's new position:
    elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
    elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
  }

  function closeDragElement(e) {
    /* stop moving when mouse button is released:*/
    document.onmouseup = null;
    document.onmousemove = null;
    elmnt.classList.remove("hold")

    const rect = elmnt.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;

    const nearbyElements = document.elementsFromPoint(centerX, centerY);
    
    for (const target of nearbyElements) {
        if (target !== elmnt && target.classList.contains('periodic-element')) {
            const targetRect = target.getBoundingClientRect();
            const distance = Math.hypot(
                centerX - (targetRect.left + targetRect.width / 2),
                centerY - (targetRect.top + targetRect.height / 2)
            );

            if (distance < rect.width) {  // Adjust this value to change fusion distance
                // Fusion logic
                target.classList.add('fused');
                target.append("!");
                elmnt.remove();
                break;
            }
        }
    }
  }
}
</script>

</body>
</html>
