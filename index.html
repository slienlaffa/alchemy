<!DOCTYPE html>
<html>
<style>
  :root {
  color-scheme: light dark;
  --square: 150px;
}
body {
  color: light-dark(#050607, rgba(225, 216, 201));
  background-color: light-dark(rgba(225, 216, 201), #050607);
}
.atomic-number {
  position: absolute;
  top: 10px;
  left: 10px;
  font-size: 18px;
  font-weight: bold;
}
.info{
  position: absolute;
  top: 10px;
  right: 10px;
  font-size: 18px;
}

.element-symbol {
  font-size: 60px;
  position: relative;
  top: -20px;
  font-weight: bold;
  text-align: center;
}

.element-name {
  position: absolute;
  bottom: 40px;
  width: 100%;
  text-align: center;
  font-size: 24px;
}

.atomic-weight {
  position: absolute;
  bottom: 10px;
  width: 100%;
  text-align: center;
  font-size: 16px;
}

.periodic-element {
  position: absolute;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  font-family: Arial, sans-serif;
  border-radius: 5px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
  width: var(--square);
  height: var(--square);
  outline: 5px solid rgb(12, 21, 111);
  opacity: 0;
  transform: scale(0.5);
  transition: opacity 0.5s, transform 0.5s;
}
.hold{
  z-index: 10;
}
.tooltip {
  display: inline-block;
  cursor: pointer;
}

.tooltip .tooltiptext {
  visibility: hidden;
  width: 600px;
  background-color: #0e3516;
  text-align: center;
  border-radius: 6px;
  outline: 1px solid #ffffff;
  padding: 5px;
  position: absolute;
  z-index: 1;
  bottom: 125%;
  left: 50%;
  margin-left: -300px;
  opacity: 0;
  transition: opacity 0.3s;
}

.tooltip .tooltiptext::after {
  content: "";
  position: absolute;
  top: 100%;
  left: 50%;
  margin-left: -10px;
  border-width: 5px;
  border-style: solid;
  border-color: #fff transparent transparent transparent;
}

.tooltip:hover .tooltiptext {
  visibility: visible;
  opacity: 1;
}

.explosion {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  width: 300vmax;
  height: 300vmax;
  background: radial-gradient(closest-side, 
    rgba(63, 135, 166, 1),
    rgba(235, 248, 225, 1),
    rgba(246, 157, 60, 0.8) 90%,
    rgba(246, 157, 60, 0) 100%
  );
  border-radius: 50%;
  opacity: 0;
  transition: transform 1.5s ease-out, opacity 1s ease-out;
  pointer-events: none;
  z-index: 1000;
}
.firework {
    position: absolute;
    transform: translate(-20%, -50%);
    z-index: 1000;
    width: calc(var(--square) * 1.7);
}
</style>
<body>

<script>
let idNumber = 0;
// Load the periodic table data
let periodicTableData;
  
function createPeriodicElement(element, x, y) {
    const elementDiv = document.createElement('div');
    elementDiv.className = 'periodic-element';
    elementDiv.style.left = `${x}px`;
    elementDiv.style.top = `${y}px`;
    elementDiv.id = `element${idNumber}`;
    elementDiv.innerHTML = `
        <div class="atomic-number">${element.number}</div>
        <div class="info tooltip">i<span class="tooltiptext">${element.summary}</span></div>
        <div class="element-symbol">${element.symbol}</div>
        <div class="element-name">${element.name}</div>
        <div class="atomic-weight">${element.atomic_mass}</div>
    `;
    idNumber++
    document.body.appendChild(elementDiv);
    requestAnimationFrame(() => {
    elementDiv.style.opacity = '1';
    elementDiv.style.transform = 'scale(1)';
  });
    dragElement(elementDiv);   
    return elementDiv;
}

function getElement(number){
  return periodicTableData[periodicTableData.order[number - 1]]
}

function placeElementHydrogen(x, y) {  
  const element = getElement(1);
  const elementDiv = createPeriodicElement(element, x, y)
}

onload = function() {
  fetch('periodic-table-lookup.json')
  .then(response => response.json())
  .then(data => {
    periodicTableData = data;
    bigBang()
  })
  .catch(error => console.error('Error loading periodic table data:', error));
}


function bigBang() {
  const maxX = innerWidth - 40;
  const maxY = innerHeight - 60;
  const sizeX = maxX / 5;
  const sizeY = maxY / 5;
  
  for (let y = 10; y < maxY; y += sizeY) {
    for (let x = 10; x < maxX; x += sizeX) {
      placeElementHydrogen(x, y);
    }
  }
}

/** Contiene toda la funcionalidad de movimiento */
function dragElement(elmnt) {
  var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
  elmnt.addEventListener("dblclick", (event) => {
    const newElement = getElement(elmnt.querySelector('.atomic-number').textContent)
    const rect = elmnt.getBoundingClientRect();
    const offset = (rect.width / 2) - 1;
    createPeriodicElement(newElement,elmnt.offsetLeft + offset,elmnt.offsetTop + offset);
  });
  elmnt.onmousedown = dragMouseDown;
  function dragMouseDown(e) {
    e = e || window.event;
    e.preventDefault();
    // get the mouse cursor position at startup:
    pos3 = e.clientX;
    pos4 = e.clientY;
    elmnt.classList.add("hold")
    document.onmouseup = closeDragElement;
    // call a function whenever the cursor moves:
    document.onmousemove = elementDrag;
  }

  function elementDrag(e) {
    e = e || window.event;
    e.preventDefault();
    // calculate the new cursor position:
    pos1 = pos3 - e.clientX;
    pos2 = pos4 - e.clientY;
    pos3 = e.clientX;
    pos4 = e.clientY;
    // set the element's new position:
    elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
    elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
  }

  function closeDragElement(e) {
    /* stop moving when mouse button is released:*/
    document.onmouseup = null;
    document.onmousemove = null;
    elmnt.classList.remove("hold")

    const rect = elmnt.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;

    const nearbyElements = document.elementsFromPoint(centerX, centerY);
    
    for (const target of nearbyElements) {
      if (target !== elmnt && target.classList.contains('periodic-element')) {
        const targetRect = target.getBoundingClientRect();
        const distance = Math.hypot(
            centerX - (targetRect.left + targetRect.width / 2),
            centerY - (targetRect.top + targetRect.height / 2)
        );

        if (distance < rect.width) {  // Adjust this value to change fusion distance
            // Fusion logic
            const newAtomicNumber = parseInt(elmnt.querySelector('.atomic-number').textContent) +
                                    parseInt(target.querySelector('.atomic-number').textContent);
            
            const newElement = getElement(newAtomicNumber);
            
            if (newElement) {
              const newElementDiv = createPeriodicElement(newElement, target.offsetLeft, target.offsetTop);
                if(newAtomicNumber == 119)
                  celebration(newElementDiv);
                target.remove();
                elmnt.remove();
            } else {
                bigCrunch(target, elmnt);
            }
            break;
        }
      }
    }
  }

  function celebration(elementDiv) {
    const celebrationGif = document.createElement('img');
    celebrationGif.src = './celebration.gif';
    celebrationGif.className = 'firework';
    celebrationGif.style.left = `${elementDiv.offsetLeft}px`;
    celebrationGif.style.top = `${elementDiv.offsetTop}px`;

    document.body.appendChild(celebrationGif);
    
    setTimeout(() => {
        celebrationGif.remove();
    }, 2000);
}

  function bigCrunch(target, elmnt) {   
    const explosionDiv = document.createElement('div');
    explosionDiv.style.left = `${target.offsetLeft}px`;
    explosionDiv.style.top = `${target.offsetTop}px`;
    explosionDiv.className = 'explosion';
    document.body.appendChild(explosionDiv);

    target.remove()
    elmnt.remove()    

    // Animate the shockwave
    setTimeout(() => {
      explosionDiv.style.transform = 'translate(-50%, -50%) scale(1)';
      explosionDiv.style.opacity = '1';
    }, 50);

    // Remove the explosion div and create the initial state again
    setTimeout(() => {
      explosionDiv.remove(); 
      document.body.innerHTML = "";
      bigBang()
    }, 1500);
  }
}
</script>

</body>
</html>
